-- ============================================================================
-- SYNC REMOTE TRACKING - Remove orphaned migration entries
-- ============================================================================
-- This deletes tracking entries for migrations that were deleted locally

-- Step 1: See what will be deleted (preview)
SELECT
  version,
  name,
  'Will be deleted - file does not exist locally' as status
FROM supabase_migrations.schema_migrations
WHERE version NOT IN (
  '000', '001', '002', '003', '004', '005', '006', '007', '008', '009',
  '010', '011', '012', '013', '014', '015', '016', '017', '018', '019',
  '020', '021', '024', '025', '026', '027', '028', '029', '030', '031',
  '032', '033', '034', '035', '036', '040', '041', '042', '066', '067',
  '068', '069', '070', '071', '072', '073', '080', '081', '082', '083',
  '089', '090', '091', '100', '101', '102', '103', '110', '111', '112',
  '113', '114', '115', '116', '117', '120', '121', '122', '123',
  '20241102', '20250102', '20250103', '20250104', '20250107', '20250114',
  '20251117', '20251229', '20251230', '20260118', '20260118132945', '999'
)
ORDER BY version;

-- Step 2: Delete orphaned entries (uncomment to execute)
/*
DELETE FROM supabase_migrations.schema_migrations
WHERE version NOT IN (
  '000', '001', '002', '003', '004', '005', '006', '007', '008', '009',
  '010', '011', '012', '013', '014', '015', '016', '017', '018', '019',
  '020', '021', '024', '025', '026', '027', '028', '029', '030', '031',
  '032', '033', '034', '035', '036', '040', '041', '042', '066', '067',
  '068', '069', '070', '071', '072', '073', '080', '081', '082', '083',
  '089', '090', '091', '100', '101', '102', '103', '110', '111', '112',
  '113', '114', '115', '116', '117', '120', '121', '122', '123',
  '20241102', '20250102', '20250103', '20250104', '20250107', '20250114',
  '20251117', '20251229', '20251230', '20260118', '20260118132945', '999'
);
*/

-- Step 3: Verify count matches local files (should be 82)
SELECT COUNT(*) as total_tracked_migrations
FROM supabase_migrations.schema_migrations;
