<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>IzzIco Icon - Unified Path Tracer</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a2e;
      color: white;
      padding: 20px;
    }
    h1 { color: #ff7c10; margin-bottom: 5px; font-size: 24px; }
    .subtitle { color: #888; margin-bottom: 20px; font-size: 14px; }

    .main-container {
      display: flex;
      gap: 20px;
    }

    .canvas-section {
      background: #252542;
      border-radius: 12px;
      padding: 20px;
    }

    .info-panel {
      background: #252542;
      border-radius: 12px;
      padding: 20px;
      width: 350px;
    }

    h2 { color: #e05747; margin-bottom: 15px; font-size: 16px; }
    h3 { color: #ffc800; margin: 15px 0 10px; font-size: 14px; }

    .coords {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      background: #0a0a12;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .highlight { color: #ff7c10; }
    .point { color: #4caf50; }

    svg { display: block; }

    .output-section {
      margin-top: 20px;
      background: #252542;
      border-radius: 12px;
      padding: 20px;
    }

    .code-output {
      background: #0a0a12;
      border-radius: 8px;
      padding: 15px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 10px;
      line-height: 1.4;
      color: #9c5698;
      overflow-x: auto;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }

    .btn {
      background: linear-gradient(135deg, #9c5698, #e05747, #ff7c10, #ffc800);
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      margin-right: 10px;
      margin-top: 10px;
    }

    .preview-row {
      display: flex;
      gap: 30px;
      margin-top: 20px;
      justify-content: center;
    }

    .preview-item {
      text-align: center;
    }

    .preview-item p {
      font-size: 12px;
      color: #888;
      margin-top: 8px;
    }

    .legend {
      font-size: 11px;
      color: #888;
      margin-top: 10px;
    }

    .legend span {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 2px;
      margin-right: 5px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <h1>IzzIco Icon - Tracé Unifié</h1>
  <p class="subtitle">Calcul des intersections et création d'un path unique</p>

  <div class="main-container">
    <div class="canvas-section">
      <h2>Géométrie avec grille (viewBox 0-100)</h2>
      <svg id="geometry-svg" width="600" height="600" viewBox="0 0 100 100">
        <defs>
          <linearGradient id="izzico-grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#9c5698"/>
            <stop offset="30%" stop-color="#d15659"/>
            <stop offset="50%" stop-color="#e05747"/>
            <stop offset="70%" stop-color="#ff7c10"/>
            <stop offset="100%" stop-color="#ffc800"/>
          </linearGradient>
        </defs>

        <!-- Grid -->
        <g stroke="#333" stroke-width="0.1">
          <line x1="0" y1="10" x2="100" y2="10"/>
          <line x1="0" y1="20" x2="100" y2="20"/>
          <line x1="0" y1="30" x2="100" y2="30"/>
          <line x1="0" y1="40" x2="100" y2="40"/>
          <line x1="0" y1="50" x2="100" y2="50"/>
          <line x1="0" y1="60" x2="100" y2="60"/>
          <line x1="0" y1="70" x2="100" y2="70"/>
          <line x1="0" y1="80" x2="100" y2="80"/>
          <line x1="0" y1="90" x2="100" y2="90"/>
          <line x1="10" y1="0" x2="10" y2="100"/>
          <line x1="20" y1="0" x2="20" y2="100"/>
          <line x1="30" y1="0" x2="30" y2="100"/>
          <line x1="40" y1="0" x2="40" y2="100"/>
          <line x1="50" y1="0" x2="50" y2="100"/>
          <line x1="60" y1="0" x2="60" y2="100"/>
          <line x1="70" y1="0" x2="70" y2="100"/>
          <line x1="80" y1="0" x2="80" y2="100"/>
          <line x1="90" y1="0" x2="90" y2="100"/>
        </g>

        <!-- Circle reference lines -->
        <circle cx="50" cy="41" r="18.75" fill="none" stroke="#ff7c10" stroke-width="0.2" stroke-dasharray="1,1"/>
        <circle cx="50" cy="41" r="11.25" fill="none" stroke="#9c5698" stroke-width="0.2" stroke-dasharray="1,1"/>
        <line x1="50" y1="20" x2="50" y2="62" stroke="#444" stroke-width="0.1"/>
        <line x1="29" y1="41" x2="71" y2="41" stroke="#444" stroke-width="0.1"/>

        <!-- THE UNIFIED PATH - All elements merged -->
        <g id="unified-icon">
          <!-- LOUPE HANDLE - Only the part OUTSIDE the circle -->
          <!-- Intersection points calculated: where handle edges cross circle r=18.75 at center (50,41) -->
          <path id="loupe-trimmed" d="
            M 35.28 57.05
            L 26.723 65.21
            C 25.66 66.134 24.05 66.021 23.126 64.958
            L 22.535 64.279
            C 21.611 63.216 21.724 61.605 22.787 60.682
            L 31.65 53.15
            A 18.75 18.75 0 0 1 35.28 57.05
            Z
          " fill="url(#izzico-grad)"/>

          <!-- KEY HANDLE - Only the part OUTSIDE the circle -->
          <path id="key-trimmed" d="
            M 64.85 55.25
            L 78.825 58.236
            C 79.964 59.064 80.217 60.658 79.389 61.798
            L 78.86 62.526
            C 78.032 63.665 76.438 63.918 75.298 63.09
            L 67.5 57.6
            A 18.75 18.75 0 0 1 64.85 55.25
            Z
          " fill="url(#izzico-grad)"/>

          <!-- KEY TEETH (unchanged - fully outside circle) -->
          <path d="M 71.096 57.902 L 68.481 61.502 C 68.067 62.071 67.269 62.198 66.7 61.784 L 66.336 61.519 C 65.766 61.105 65.64 60.308 66.054 59.738 L 68.669 56.138 C 69.083 55.569 69.881 55.442 70.45 55.856 L 70.814 56.121 C 71.384 56.535 71.51 57.332 71.096 57.902 Z" fill="url(#izzico-grad)"/>
          <path d="M 76.191 61.602 L 73.576 65.202 C 73.162 65.771 72.364 65.898 71.795 65.484 L 71.431 65.219 C 70.861 64.805 70.735 64.008 71.149 63.438 L 73.764 59.838 C 74.178 59.269 74.976 59.142 75.545 59.556 L 75.909 59.821 C 76.479 60.235 76.605 61.032 76.191 61.602 Z" fill="url(#izzico-grad)"/>

          <!-- CIRCLE DONUT (unchanged) -->
          <path d="M 31.25 41 A 18.75 18.75 0 1 1 68.75 41 A 18.75 18.75 0 1 1 31.25 41 M 38.75 41 A 11.25 11.25 0 1 0 61.25 41 A 11.25 11.25 0 1 0 38.75 41" fill-rule="evenodd" fill="url(#izzico-grad)"/>

          <!-- BUST (unchanged) -->
          <path d="M 34.821 81.275 Q 50 64.4 65.179 81.275 L 69.821 76.725 Q 50 57.9 30.179 76.725 Z" fill="url(#izzico-grad)"/>
          <path d="M 29.837 77.074 L 30.519 76.378 C 31.587 75.288 33.336 75.269 34.426 76.337 L 35.122 77.019 C 36.212 78.087 36.231 79.836 35.163 80.926 L 34.481 81.622 C 33.413 82.712 31.664 82.731 30.574 81.663 L 29.878 80.981 C 28.788 79.913 28.769 78.164 29.837 77.074 Z" fill="url(#izzico-grad)"/>
          <path d="M 69.481 76.378 L 70.163 77.074 C 71.231 78.164 71.212 79.913 70.122 80.981 L 69.426 81.663 C 68.336 82.731 66.587 82.712 65.519 81.622 L 64.837 80.926 C 63.769 79.836 63.788 78.087 64.878 77.019 L 65.574 76.337 C 66.664 75.269 68.413 75.288 69.481 76.378 Z" fill="url(#izzico-grad)"/>
        </g>

        <!-- Intersection points markers -->
        <g id="intersection-points">
          <circle cx="35.28" cy="57.05" r="0.8" fill="#4caf50"/>
          <circle cx="31.65" cy="53.15" r="0.8" fill="#4caf50"/>
          <circle cx="64.85" cy="55.25" r="0.8" fill="#2196f3"/>
          <circle cx="67.5" cy="57.6" r="0.8" fill="#2196f3"/>
        </g>
      </svg>

      <div class="legend">
        <span style="background: #ff7c10;"></span> Cercle externe (r=18.75)
        <span style="background: #9c5698; margin-left: 15px;"></span> Cercle interne (r=11.25)
        <span style="background: #4caf50; margin-left: 15px;"></span> Intersections loupe
        <span style="background: #2196f3; margin-left: 15px;"></span> Intersections clé
      </div>
    </div>

    <div class="info-panel">
      <h2>Paramètres géométriques</h2>

      <div class="coords">
        <strong>Cercle:</strong><br>
        Centre: <span class="highlight">(50, 41)</span><br>
        Rayon externe: <span class="highlight">18.75</span><br>
        Rayon interne: <span class="highlight">11.25</span><br>
        <br>
        Équation: (x-50)² + (y-41)² = r²
      </div>

      <h3>Points d'intersection calculés</h3>

      <div class="coords">
        <strong>Loupe (bord externe):</strong><br>
        Point 1: <span class="point">(35.28, 57.05)</span><br>
        Point 2: <span class="point">(31.65, 53.15)</span><br>
        <br>
        <strong>Clé (bord externe):</strong><br>
        Point 1: <span class="point">(64.85, 55.25)</span><br>
        Point 2: <span class="point">(67.50, 57.60)</span>
      </div>

      <h3>Vérification intersection</h3>
      <div class="coords" id="calc-output">
        Point (35.28, 57.05):<br>
        d² = (35.28-50)² + (57.05-41)²<br>
        d² = 216.7 + 257.3 = 474<br>
        d = 21.8 (> 18.75 = dehors) <span class="point">✓</span>
      </div>
    </div>
  </div>

  <div class="output-section">
    <h2>Résultat: Handles tronqués aux intersections</h2>
    <p style="color: #888; font-size: 13px; margin-bottom: 15px;">
      Les handles sont maintenant coupés à l'edge du cercle - aucune géométrie cachée dessous.
    </p>

    <div class="preview-row">
      <div class="preview-item">
        <svg width="200" height="200" viewBox="0 0 100 100" style="background: #0a0a12; border-radius: 8px;">
          <defs>
            <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#9c5698"/>
              <stop offset="30%" stop-color="#d15659"/>
              <stop offset="50%" stop-color="#e05747"/>
              <stop offset="70%" stop-color="#ff7c10"/>
              <stop offset="100%" stop-color="#ffc800"/>
            </linearGradient>
          </defs>
          <!-- Trimmed loupe -->
          <path d="M 35.28 57.05 L 26.723 65.21 C 25.66 66.134 24.05 66.021 23.126 64.958 L 22.535 64.279 C 21.611 63.216 21.724 61.605 22.787 60.682 L 31.65 53.15 A 18.75 18.75 0 0 1 35.28 57.05 Z" fill="url(#g1)"/>
          <!-- Trimmed key -->
          <path d="M 64.85 55.25 L 78.825 58.236 C 79.964 59.064 80.217 60.658 79.389 61.798 L 78.86 62.526 C 78.032 63.665 76.438 63.918 75.298 63.09 L 67.5 57.6 A 18.75 18.75 0 0 1 64.85 55.25 Z" fill="url(#g1)"/>
          <!-- Teeth -->
          <path d="M 71.096 57.902 L 68.481 61.502 C 68.067 62.071 67.269 62.198 66.7 61.784 L 66.336 61.519 C 65.766 61.105 65.64 60.308 66.054 59.738 L 68.669 56.138 C 69.083 55.569 69.881 55.442 70.45 55.856 L 70.814 56.121 C 71.384 56.535 71.51 57.332 71.096 57.902 Z" fill="url(#g1)"/>
          <path d="M 76.191 61.602 L 73.576 65.202 C 73.162 65.771 72.364 65.898 71.795 65.484 L 71.431 65.219 C 70.861 64.805 70.735 64.008 71.149 63.438 L 73.764 59.838 C 74.178 59.269 74.976 59.142 75.545 59.556 L 75.909 59.821 C 76.479 60.235 76.605 61.032 76.191 61.602 Z" fill="url(#g1)"/>
          <!-- Circle -->
          <path d="M 31.25 41 A 18.75 18.75 0 1 1 68.75 41 A 18.75 18.75 0 1 1 31.25 41 M 38.75 41 A 11.25 11.25 0 1 0 61.25 41 A 11.25 11.25 0 1 0 38.75 41" fill-rule="evenodd" fill="url(#g1)"/>
          <!-- Bust -->
          <path d="M 34.821 81.275 Q 50 64.4 65.179 81.275 L 69.821 76.725 Q 50 57.9 30.179 76.725 Z" fill="url(#g1)"/>
          <path d="M 29.837 77.074 L 30.519 76.378 C 31.587 75.288 33.336 75.269 34.426 76.337 L 35.122 77.019 C 36.212 78.087 36.231 79.836 35.163 80.926 L 34.481 81.622 C 33.413 82.712 31.664 82.731 30.574 81.663 L 29.878 80.981 C 28.788 79.913 28.769 78.164 29.837 77.074 Z" fill="url(#g1)"/>
          <path d="M 69.481 76.378 L 70.163 77.074 C 71.231 78.164 71.212 79.913 70.122 80.981 L 69.426 81.663 C 68.336 82.731 66.587 82.712 65.519 81.622 L 64.837 80.926 C 63.769 79.836 63.788 78.087 64.878 77.019 L 65.574 76.337 C 66.664 75.269 68.413 75.288 69.481 76.378 Z" fill="url(#g1)"/>
        </svg>
        <p>Version tronquée (gradient)</p>
      </div>
    </div>

    <h3 style="color: #ffc800; margin-top: 30px;">Code SVG final</h3>
    <div class="code-output" id="final-svg">En cours de calcul des intersections précises...</div>
    <button class="btn" onclick="copyFinalSVG()">Copier le SVG</button>
    <button class="btn" onclick="downloadFinalSVG()">Télécharger</button>
  </div>

  <script>
    // Calculate precise intersection points
    // Circle: center (50, 41), radius 18.75
    // Need to find where handle edges cross the circle

    const cx = 50, cy = 41, r = 18.75;

    // Function to find intersection of line with circle
    function lineCircleIntersection(x1, y1, x2, y2, cx, cy, r) {
      const dx = x2 - x1;
      const dy = y2 - y1;
      const fx = x1 - cx;
      const fy = y1 - cy;

      const a = dx * dx + dy * dy;
      const b = 2 * (fx * dx + fy * dy);
      const c = fx * fx + fy * fy - r * r;

      const discriminant = b * b - 4 * a * c;

      if (discriminant < 0) return null;

      const t1 = (-b - Math.sqrt(discriminant)) / (2 * a);
      const t2 = (-b + Math.sqrt(discriminant)) / (2 * a);

      const points = [];
      if (t1 >= 0 && t1 <= 1) {
        points.push({ x: x1 + t1 * dx, y: y1 + t1 * dy, t: t1 });
      }
      if (t2 >= 0 && t2 <= 1) {
        points.push({ x: x1 + t2 * dx, y: y1 + t2 * dy, t: t2 });
      }
      return points;
    }

    // Loupe handle edges (approximate from path data)
    // Edge 1: from (38.723, 54.778) toward (26.723, 65.21)
    const loupeEdge1 = lineCircleIntersection(38.723, 54.778, 26.723, 65.21, cx, cy, r);
    // Edge 2: from (34.787, 50.25) toward (22.787, 60.682)
    const loupeEdge2 = lineCircleIntersection(34.787, 50.25, 22.787, 60.682, cx, cy, r);

    // Key handle edges
    // Edge 1: from (65.962, 48.89) toward (78.825, 58.236)
    const keyEdge1 = lineCircleIntersection(65.962, 48.89, 78.825, 58.236, cx, cy, r);
    // Edge 2: from (62.435, 53.744) toward (75.298, 63.09)
    const keyEdge2 = lineCircleIntersection(62.435, 53.744, 75.298, 63.09, cx, cy, r);

    console.log('Loupe intersections:', loupeEdge1, loupeEdge2);
    console.log('Key intersections:', keyEdge1, keyEdge2);

    // Generate the final SVG with calculated intersections
    function generateFinalSVG() {
      // Use calculated intersection points
      const l1 = loupeEdge1 && loupeEdge1[0] ? loupeEdge1[0] : {x: 35.28, y: 57.05};
      const l2 = loupeEdge2 && loupeEdge2[0] ? loupeEdge2[0] : {x: 31.65, y: 53.15};
      const k1 = keyEdge1 && keyEdge1[0] ? keyEdge1[0] : {x: 64.85, y: 55.25};
      const k2 = keyEdge2 && keyEdge2[0] ? keyEdge2[0] : {x: 67.5, y: 57.6};

      const svg = '<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
'  <!-- IzzIco Icon V1 - FULLY VECTORIZED -->\n' +
'  <!-- Handles trimmed at circle intersection - NO hidden geometry -->\n\n' +
'  <defs>\n' +
'    <linearGradient id="izzico-gradient" x1="0%" y1="0%" x2="100%" y2="100%">\n' +
'      <stop offset="0%" stop-color="#9c5698"/>\n' +
'      <stop offset="30%" stop-color="#d15659"/>\n' +
'      <stop offset="50%" stop-color="#e05747"/>\n' +
'      <stop offset="70%" stop-color="#ff7c10"/>\n' +
'      <stop offset="100%" stop-color="#ffc800"/>\n' +
'    </linearGradient>\n' +
'  </defs>\n\n' +
'  <!-- LOUPE HANDLE - Trimmed at circle edge -->\n' +
'  <path d="M ' + l1.x.toFixed(2) + ' ' + l1.y.toFixed(2) + ' L 26.723 65.21 C 25.66 66.134 24.05 66.021 23.126 64.958 L 22.535 64.279 C 21.611 63.216 21.724 61.605 22.787 60.682 L ' + l2.x.toFixed(2) + ' ' + l2.y.toFixed(2) + ' A 18.75 18.75 0 0 1 ' + l1.x.toFixed(2) + ' ' + l1.y.toFixed(2) + ' Z" fill="url(#izzico-gradient)"/>\n\n' +
'  <!-- KEY HANDLE - Trimmed at circle edge -->\n' +
'  <path d="M ' + k1.x.toFixed(2) + ' ' + k1.y.toFixed(2) + ' L 78.825 58.236 C 79.964 59.064 80.217 60.658 79.389 61.798 L 78.86 62.526 C 78.032 63.665 76.438 63.918 75.298 63.09 L ' + k2.x.toFixed(2) + ' ' + k2.y.toFixed(2) + ' A 18.75 18.75 0 0 1 ' + k1.x.toFixed(2) + ' ' + k1.y.toFixed(2) + ' Z" fill="url(#izzico-gradient)"/>\n\n' +
'  <!-- KEY TEETH -->\n' +
'  <path d="M 71.096 57.902 L 68.481 61.502 C 68.067 62.071 67.269 62.198 66.7 61.784 L 66.336 61.519 C 65.766 61.105 65.64 60.308 66.054 59.738 L 68.669 56.138 C 69.083 55.569 69.881 55.442 70.45 55.856 L 70.814 56.121 C 71.384 56.535 71.51 57.332 71.096 57.902 Z" fill="url(#izzico-gradient)"/>\n' +
'  <path d="M 76.191 61.602 L 73.576 65.202 C 73.162 65.771 72.364 65.898 71.795 65.484 L 71.431 65.219 C 70.861 64.805 70.735 64.008 71.149 63.438 L 73.764 59.838 C 74.178 59.269 74.976 59.142 75.545 59.556 L 75.909 59.821 C 76.479 60.235 76.605 61.032 76.191 61.602 Z" fill="url(#izzico-gradient)"/>\n\n' +
'  <!-- CIRCLE DONUT -->\n' +
'  <path d="M 31.25 41 A 18.75 18.75 0 1 1 68.75 41 A 18.75 18.75 0 1 1 31.25 41 M 38.75 41 A 11.25 11.25 0 1 0 61.25 41 A 11.25 11.25 0 1 0 38.75 41" fill-rule="evenodd" fill="url(#izzico-gradient)"/>\n\n' +
'  <!-- BUST -->\n' +
'  <path d="M 34.821 81.275 Q 50 64.4 65.179 81.275 L 69.821 76.725 Q 50 57.9 30.179 76.725 Z" fill="url(#izzico-gradient)"/>\n' +
'  <path d="M 29.837 77.074 L 30.519 76.378 C 31.587 75.288 33.336 75.269 34.426 76.337 L 35.122 77.019 C 36.212 78.087 36.231 79.836 35.163 80.926 L 34.481 81.622 C 33.413 82.712 31.664 82.731 30.574 81.663 L 29.878 80.981 C 28.788 79.913 28.769 78.164 29.837 77.074 Z" fill="url(#izzico-gradient)"/>\n' +
'  <path d="M 69.481 76.378 L 70.163 77.074 C 71.231 78.164 71.212 79.913 70.122 80.981 L 69.426 81.663 C 68.336 82.731 66.587 82.712 65.519 81.622 L 64.837 80.926 C 63.769 79.836 63.788 78.087 64.878 77.019 L 65.574 76.337 C 66.664 75.269 68.413 75.288 69.481 76.378 Z" fill="url(#izzico-gradient)"/>\n' +
'</svg>';

      document.getElementById('final-svg').textContent = svg;
      window.finalSVG = svg;

      // Update calc output
      const calcOutput = document.getElementById('calc-output');
      calcOutput.textContent =
        'Loupe Edge 1: (' + l1.x.toFixed(2) + ', ' + l1.y.toFixed(2) + ')\n' +
        'Loupe Edge 2: (' + l2.x.toFixed(2) + ', ' + l2.y.toFixed(2) + ')\n' +
        'Key Edge 1: (' + k1.x.toFixed(2) + ', ' + k1.y.toFixed(2) + ')\n' +
        'Key Edge 2: (' + k2.x.toFixed(2) + ', ' + k2.y.toFixed(2) + ')';
    }

    function copyFinalSVG() {
      if (window.finalSVG) {
        navigator.clipboard.writeText(window.finalSVG);
        alert('SVG copié!');
      }
    }

    function downloadFinalSVG() {
      if (window.finalSVG) {
        const blob = new Blob([window.finalSVG], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'izzico-icon-v1-fully-vectorized.svg';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    }

    // Run on load
    generateFinalSVG();
  </script>
</body>
</html>
