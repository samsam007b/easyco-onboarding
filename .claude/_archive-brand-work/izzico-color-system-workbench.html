<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IzzIco - Color System Workbench</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a12;
            --panel: #12121a;
            --control: #1a1a24;
            --border: #2a2a3a;
            --text: #e8e8f0;
            --text-muted: #8888a0;
            --accent: #6366f1;
            --searcher: #FFB10B;
            --owner: #9B59B6;
            --resident: #E67E22;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            background: var(--panel);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo {
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--control);
            padding: 0.25rem;
            border-radius: 12px;
        }
        .tab {
            padding: 0.5rem 1rem;
            border-radius: 10px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab.active {
            background: var(--accent);
            color: white;
        }
        .tab:hover:not(.active) {
            color: var(--text);
        }
        .main {
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .section.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Color Wheel Section */
        .color-wheel-container {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
        }
        .wheel-wrapper {
            background: var(--panel);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
        }
        .color-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            position: relative;
            cursor: crosshair;
        }
        .wheel-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .sliders {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .slider-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .slider-label {
            width: 80px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .slider {
            flex: 1;
            height: 12px;
            border-radius: 6px;
            -webkit-appearance: none;
            cursor: pointer;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--border);
            cursor: pointer;
        }
        .slider-value {
            width: 50px;
            text-align: right;
            font-family: monospace;
            font-size: 0.85rem;
        }
        .selected-color-display {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }
        .color-preview {
            width: 100px;
            height: 100px;
            border-radius: 16px;
            border: 2px solid var(--border);
        }
        .color-values {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .color-value-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .color-value-label {
            width: 40px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .color-value-input {
            flex: 1;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--control);
            color: var(--text);
            font-family: monospace;
            font-size: 0.85rem;
        }
        .copy-btn {
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--control);
            color: var(--text);
            cursor: pointer;
            transition: all 0.15s;
        }
        .copy-btn:hover {
            background: var(--border);
        }

        /* Nuances Grid */
        .nuances-grid {
            background: var(--panel);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
        }
        .nuances-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .lightness-grid {
            display: grid;
            grid-template-columns: repeat(21, 1fr);
            gap: 3px;
            margin-bottom: 1.5rem;
        }
        .saturation-grid {
            display: grid;
            grid-template-columns: repeat(21, 1fr);
            gap: 3px;
            margin-bottom: 1.5rem;
        }
        .nuance-cell {
            aspect-ratio: 1;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.15s;
            position: relative;
        }
        .nuance-cell:hover {
            transform: scale(1.15);
            z-index: 10;
        }
        .nuance-cell::after {
            content: attr(data-value);
            position: absolute;
            bottom: -16px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.55rem;
            opacity: 0;
            transition: opacity 0.15s;
            white-space: nowrap;
        }
        .nuance-cell:hover::after {
            opacity: 1;
        }
        .full-spectrum {
            display: grid;
            grid-template-columns: repeat(72, 1fr);
            gap: 1px;
        }
        .spectrum-cell {
            aspect-ratio: 1;
            border-radius: 2px;
            cursor: pointer;
            transition: transform 0.15s;
        }
        .spectrum-cell:hover {
            transform: scale(1.5);
            z-index: 10;
        }

        /* Role Colors Section */
        .role-colors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }
        .role-card {
            background: var(--panel);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        .role-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .role-swatch {
            width: 60px;
            height: 60px;
            border-radius: 16px;
        }
        .role-name {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .role-hex {
            font-family: monospace;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        .role-scale {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .scale-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .scale-label {
            width: 30px;
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: right;
        }
        .scale-swatch {
            flex: 1;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-family: monospace;
            font-size: 0.7rem;
            transition: transform 0.1s;
        }
        .scale-swatch:hover {
            transform: scaleX(1.02);
        }

        /* Harmonies Section */
        .harmonies-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .harmony-card {
            background: var(--panel);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        .harmony-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .harmony-colors {
            display: flex;
            gap: 0.5rem;
        }
        .harmony-swatch {
            flex: 1;
            height: 80px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 0.5rem;
            transition: transform 0.15s;
        }
        .harmony-swatch:hover {
            transform: translateY(-4px);
        }
        .harmony-hex {
            font-family: monospace;
            font-size: 0.7rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Palette Generator */
        .palette-generator {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }
        .generated-palette {
            background: var(--panel);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        .palette-colors {
            display: flex;
            height: 200px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        .palette-slot {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding: 1rem;
            cursor: pointer;
            transition: flex 0.3s;
            position: relative;
        }
        .palette-slot:hover {
            flex: 1.2;
        }
        .palette-slot.locked::before {
            content: 'üîí';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }
        .palette-slot-hex {
            font-family: monospace;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .palette-slot-name {
            font-size: 0.7rem;
            opacity: 0.8;
        }
        .palette-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .palette-btn {
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--control);
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.15s;
        }
        .palette-btn:hover {
            background: var(--border);
        }
        .palette-btn.primary {
            background: var(--accent);
            border-color: var(--accent);
        }
        .generator-options {
            background: var(--panel);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        .option-group {
            margin-bottom: 1.5rem;
        }
        .option-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        .option-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        .option-btn {
            padding: 0.4rem 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--control);
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
        }
        .option-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Full Spectrum */
        .spectrum-section {
            background: var(--panel);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
        }
        .spectrum-desc {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }
        .mega-spectrum {
            display: grid;
            gap: 1px;
        }
        .spectrum-row {
            display: flex;
            gap: 1px;
        }
        .mega-cell {
            width: 8px;
            height: 8px;
            cursor: crosshair;
            transition: transform 0.1s;
        }
        .mega-cell:hover {
            transform: scale(2.5);
            z-index: 100;
            border-radius: 2px;
        }

        /* Export Section */
        .export-section {
            background: var(--panel);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-top: 2rem;
        }
        .export-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .export-content {
            background: var(--control);
            border-radius: 12px;
            padding: 1.5rem;
            font-family: monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            line-height: 1.6;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--accent);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 0.9rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        @media (max-width: 1200px) {
            .color-wheel-container {
                grid-template-columns: 1fr;
            }
            .palette-generator {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üé® IzzIco Color System</div>
        <div class="tabs">
            <button class="tab active" data-section="picker">Picker</button>
            <button class="tab" data-section="roles">R√¥les</button>
            <button class="tab" data-section="harmonies">Harmonies</button>
            <button class="tab" data-section="generator">G√©n√©rateur</button>
            <button class="tab" data-section="spectrum">Spectre Complet</button>
        </div>
    </div>

    <div class="main">
        <!-- Color Picker Section -->
        <section class="section active" id="picker">
            <h2 class="section-title">üéØ S√©lecteur de Couleurs</h2>
            <div class="color-wheel-container">
                <div class="wheel-wrapper">
                    <div class="color-wheel" id="colorWheel">
                        <div class="wheel-indicator" id="wheelIndicator"></div>
                    </div>
                    <div class="sliders">
                        <div class="slider-group">
                            <span class="slider-label">Teinte</span>
                            <input type="range" class="slider" id="hueSlider" min="0" max="360" value="30">
                            <span class="slider-value" id="hueValue">30</span>
                        </div>
                        <div class="slider-group">
                            <span class="slider-label">Saturation</span>
                            <input type="range" class="slider" id="satSlider" min="0" max="100" value="90">
                            <span class="slider-value" id="satValue">90%</span>
                        </div>
                        <div class="slider-group">
                            <span class="slider-label">Luminosit√©</span>
                            <input type="range" class="slider" id="lightSlider" min="0" max="100" value="52">
                            <span class="slider-value" id="lightValue">52%</span>
                        </div>
                    </div>
                    <div class="selected-color-display">
                        <div class="color-preview" id="colorPreview"></div>
                        <div class="color-values">
                            <div class="color-value-row">
                                <span class="color-value-label">HEX</span>
                                <input type="text" class="color-value-input" id="hexInput" value="#FFB10B">
                                <button class="copy-btn" data-copy="hex">üìã</button>
                            </div>
                            <div class="color-value-row">
                                <span class="color-value-label">RGB</span>
                                <input type="text" class="color-value-input" id="rgbInput" value="rgb(255, 177, 11)">
                                <button class="copy-btn" data-copy="rgb">üìã</button>
                            </div>
                            <div class="color-value-row">
                                <span class="color-value-label">HSL</span>
                                <input type="text" class="color-value-input" id="hslInput" value="hsl(30, 90%, 52%)">
                                <button class="copy-btn" data-copy="hsl">üìã</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="nuances-grid">
                    <div class="nuances-title">Variations de Luminosit√© (0% ‚Üí 100%)</div>
                    <div class="lightness-grid" id="lightnessGrid"></div>

                    <div class="nuances-title">Variations de Saturation (0% ‚Üí 100%)</div>
                    <div class="saturation-grid" id="saturationGrid"></div>

                    <div class="nuances-title">Spectre Chromatique (toutes les teintes)</div>
                    <div class="full-spectrum" id="hueSpectrum"></div>
                </div>
            </div>
        </section>

        <!-- Role Colors Section -->
        <section class="section" id="roles">
            <h2 class="section-title">üë• Couleurs des R√¥les IzzIco</h2>
            <div class="role-colors" id="roleColors"></div>
        </section>

        <!-- Harmonies Section -->
        <section class="section" id="harmonies">
            <h2 class="section-title">üéµ Harmonies de Couleurs</h2>
            <div class="harmonies-container" id="harmoniesContainer"></div>
        </section>

        <!-- Palette Generator Section -->
        <section class="section" id="generator">
            <h2 class="section-title">‚ú® G√©n√©rateur de Palette</h2>
            <div class="palette-generator">
                <div class="generated-palette">
                    <div class="palette-colors" id="paletteColors"></div>
                    <div class="palette-controls">
                        <button class="palette-btn primary" id="generateBtn">üé≤ G√©n√©rer (Espace)</button>
                        <button class="palette-btn" id="undoBtn">‚Ü©Ô∏è Annuler</button>
                        <button class="palette-btn" id="exportCssBtn">Export CSS</button>
                        <button class="palette-btn" id="exportTailwindBtn">Export Tailwind</button>
                    </div>
                </div>
                <div class="generator-options">
                    <div class="option-group">
                        <div class="option-label">Mode d'harmonie</div>
                        <div class="option-buttons" id="harmonyOptions"></div>
                    </div>
                    <div class="option-group">
                        <div class="option-label">Luminosit√© de base</div>
                        <div class="option-buttons" id="lightnessOptions"></div>
                    </div>
                    <div class="option-group">
                        <div class="option-label">Saturation</div>
                        <div class="option-buttons" id="saturationOptions"></div>
                    </div>
                </div>
            </div>
            <div class="export-section" id="exportSection" style="display: none;">
                <div class="export-tabs" id="exportTabs"></div>
                <div class="export-content" id="exportContent"></div>
            </div>
        </section>

        <!-- Full Spectrum Section -->
        <section class="section" id="spectrum">
            <h2 class="section-title">üåà Spectre Complet (Toutes les Nuances)</h2>
            <div class="spectrum-section">
                <p class="spectrum-desc">Cliquez sur n'importe quelle couleur pour la copier. Survolez pour agrandir. Ce spectre contient <strong>25,920 couleurs</strong> (360 teintes √ó 5 saturations √ó 20 luminosit√©s).</p>
                <div class="mega-spectrum" id="megaSpectrum"></div>
            </div>
        </section>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // ============ STATE ============
        var currentHSL = { h: 30, s: 90, l: 52 };
        var palette = [];
        var paletteHistory = [];
        var generatorSettings = {
            harmony: 'analogous',
            lightness: 'medium',
            saturation: 'vibrant'
        };

        // IzzIco Role Colors
        var ROLES = {
            searcher: { name: 'Searcher', hex: '#FFB10B', emoji: 'üîç' },
            owner: { name: 'Owner', hex: '#9B59B6', emoji: 'üîë' },
            resident: { name: 'Resident', hex: '#E67E22', emoji: 'üë§' }
        };

        // ============ COLOR UTILITIES ============
        function hslToHex(h, s, l) {
            h = ((h % 360) + 360) % 360;
            s = Math.max(0, Math.min(100, s)) / 100;
            l = Math.max(0, Math.min(100, l)) / 100;
            var c = (1 - Math.abs(2 * l - 1)) * s;
            var x = c * (1 - Math.abs((h / 60) % 2 - 1));
            var m = l - c / 2;
            var r = 0, g = 0, b = 0;
            if (h < 60) { r = c; g = x; }
            else if (h < 120) { r = x; g = c; }
            else if (h < 180) { g = c; b = x; }
            else if (h < 240) { g = x; b = c; }
            else if (h < 300) { r = x; b = c; }
            else { r = c; b = x; }
            return '#' + [r, g, b].map(function(v) {
                return Math.round((v + m) * 255).toString(16).padStart(2, '0');
            }).join('').toUpperCase();
        }

        function hexToHSL(hex) {
            var r = parseInt(hex.slice(1, 3), 16) / 255;
            var g = parseInt(hex.slice(3, 5), 16) / 255;
            var b = parseInt(hex.slice(5, 7), 16) / 255;
            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h = 0, s = 0, l = (max + min) / 2;
            if (max !== min) {
                var d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                if (max === r) h = ((g - b) / d + (g < b ? 6 : 0)) / 6;
                else if (max === g) h = ((b - r) / d + 2) / 6;
                else h = ((r - g) / d + 4) / 6;
            }
            return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
        }

        function hexToRGB(hex) {
            return {
                r: parseInt(hex.slice(1, 3), 16),
                g: parseInt(hex.slice(3, 5), 16),
                b: parseInt(hex.slice(5, 7), 16)
            };
        }

        function isLightColor(hex) {
            var rgb = hexToRGB(hex);
            return (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255 > 0.5;
        }

        function getColorName(h, s, l) {
            if (s < 10) {
                if (l < 15) return 'Noir';
                if (l > 85) return 'Blanc';
                return 'Gris';
            }
            var names = [
                [15, 'Rouge'], [45, 'Orange'], [75, 'Jaune'],
                [150, 'Vert'], [195, 'Cyan'], [255, 'Bleu'],
                [285, 'Violet'], [330, 'Rose'], [360, 'Rouge']
            ];
            for (var i = 0; i < names.length; i++) {
                if (h <= names[i][0]) return names[i][1];
            }
            return 'Rouge';
        }

        // Generate color scale (50-900)
        function generateScale(baseHex) {
            var hsl = hexToHSL(baseHex);
            var scale = {};
            var steps = [
                { name: '50', l: 97, sMod: 0.3 },
                { name: '100', l: 93, sMod: 0.5 },
                { name: '200', l: 86, sMod: 0.6 },
                { name: '300', l: 76, sMod: 0.7 },
                { name: '400', l: 65, sMod: 0.85 },
                { name: '500', l: 52, sMod: 1 },
                { name: '600', l: 43, sMod: 0.95 },
                { name: '700', l: 35, sMod: 0.9 },
                { name: '800', l: 25, sMod: 0.85 },
                { name: '900', l: 15, sMod: 0.8 }
            ];
            steps.forEach(function(step) {
                scale[step.name] = hslToHex(hsl.h, hsl.s * step.sMod, step.l);
            });
            return scale;
        }

        // ============ DOM HELPERS ============
        function el(id) { return document.getElementById(id); }
        function clearEl(element) { while (element.firstChild) element.removeChild(element.firstChild); }
        function createEl(tag, attrs, text) {
            var element = document.createElement(tag);
            if (attrs) {
                Object.keys(attrs).forEach(function(k) {
                    if (k === 'className') element.className = attrs[k];
                    else if (k === 'style' && typeof attrs[k] === 'object') {
                        Object.assign(element.style, attrs[k]);
                    } else element.setAttribute(k, attrs[k]);
                });
            }
            if (text !== undefined) element.textContent = text;
            return element;
        }

        function showToast(message) {
            var toast = el('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(function() { toast.classList.remove('show'); }, 2000);
        }

        // ============ COLOR WHEEL ============
        function drawColorWheel() {
            var wheel = el('colorWheel');
            var size = 300;
            var canvas = createEl('canvas', { width: size, height: size });
            canvas.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:100%;border-radius:50%;';
            var ctx = canvas.getContext('2d');
            var centerX = size / 2, centerY = size / 2;
            var radius = size / 2;

            // Draw hue wheel with saturation gradient
            for (var angle = 0; angle < 360; angle++) {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, (angle - 1) * Math.PI / 180, (angle + 1) * Math.PI / 180);
                ctx.closePath();

                var gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                gradient.addColorStop(0, hslToHex(angle, 0, 50));
                gradient.addColorStop(0.5, hslToHex(angle, 50, 50));
                gradient.addColorStop(1, hslToHex(angle, 100, 50));
                ctx.fillStyle = gradient;
                ctx.fill();
            }

            clearEl(wheel);
            wheel.appendChild(canvas);
            var indicator = createEl('div', { className: 'wheel-indicator', id: 'wheelIndicator' });
            wheel.appendChild(indicator);

            updateWheelIndicator();
        }

        function updateWheelIndicator() {
            var indicator = el('wheelIndicator');
            if (!indicator) return;
            var angle = currentHSL.h * Math.PI / 180;
            var dist = (currentHSL.s / 100) * 150;
            var x = 150 + Math.cos(angle - Math.PI/2) * dist;
            var y = 150 + Math.sin(angle - Math.PI/2) * dist;
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            indicator.style.backgroundColor = hslToHex(currentHSL.h, currentHSL.s, currentHSL.l);
        }

        function handleWheelClick(e) {
            var wheel = el('colorWheel');
            var rect = wheel.getBoundingClientRect();
            var x = e.clientX - rect.left - 150;
            var y = e.clientY - rect.top - 150;
            var angle = Math.atan2(y, x) + Math.PI/2;
            if (angle < 0) angle += Math.PI * 2;
            var dist = Math.min(Math.sqrt(x*x + y*y), 150);

            currentHSL.h = Math.round(angle * 180 / Math.PI);
            currentHSL.s = Math.round((dist / 150) * 100);

            updateColorDisplay();
        }

        // ============ SLIDERS ============
        function initSliders() {
            updateSliderBackgrounds();

            el('hueSlider').oninput = function() {
                currentHSL.h = parseInt(this.value);
                updateColorDisplay();
            };
            el('satSlider').oninput = function() {
                currentHSL.s = parseInt(this.value);
                updateColorDisplay();
            };
            el('lightSlider').oninput = function() {
                currentHSL.l = parseInt(this.value);
                updateColorDisplay();
            };
        }

        function updateSliderBackgrounds() {
            var hueSlider = el('hueSlider');
            var satSlider = el('satSlider');
            var lightSlider = el('lightSlider');

            // Hue slider rainbow
            var hueColors = [];
            for (var h = 0; h <= 360; h += 30) {
                hueColors.push(hslToHex(h, 100, 50));
            }
            hueSlider.style.background = 'linear-gradient(to right, ' + hueColors.join(', ') + ')';

            // Saturation slider
            satSlider.style.background = 'linear-gradient(to right, ' +
                hslToHex(currentHSL.h, 0, currentHSL.l) + ', ' +
                hslToHex(currentHSL.h, 100, currentHSL.l) + ')';

            // Lightness slider
            lightSlider.style.background = 'linear-gradient(to right, ' +
                hslToHex(currentHSL.h, currentHSL.s, 0) + ', ' +
                hslToHex(currentHSL.h, currentHSL.s, 50) + ', ' +
                hslToHex(currentHSL.h, currentHSL.s, 100) + ')';
        }

        // ============ NUANCES GRIDS ============
        function renderNuancesGrids() {
            var lightnessGrid = el('lightnessGrid');
            var saturationGrid = el('saturationGrid');
            var hueSpectrum = el('hueSpectrum');

            clearEl(lightnessGrid);
            clearEl(saturationGrid);
            clearEl(hueSpectrum);

            // Lightness variations (0-100 by 5)
            for (var l = 0; l <= 100; l += 5) {
                var cell = createEl('div', {
                    className: 'nuance-cell',
                    'data-value': l + '%'
                });
                var hex = hslToHex(currentHSL.h, currentHSL.s, l);
                cell.style.backgroundColor = hex;
                cell.style.color = isLightColor(hex) ? '#1a1a2e' : '#ffffff';
                cell.onclick = (function(h) { return function() { copyColor(h); }; })(hex);
                lightnessGrid.appendChild(cell);
            }

            // Saturation variations (0-100 by 5)
            for (var s = 0; s <= 100; s += 5) {
                var cell = createEl('div', {
                    className: 'nuance-cell',
                    'data-value': s + '%'
                });
                var hex = hslToHex(currentHSL.h, s, currentHSL.l);
                cell.style.backgroundColor = hex;
                cell.style.color = isLightColor(hex) ? '#1a1a2e' : '#ffffff';
                cell.onclick = (function(h) { return function() { copyColor(h); }; })(hex);
                saturationGrid.appendChild(cell);
            }

            // Full hue spectrum (0-360 by 5)
            for (var h = 0; h < 360; h += 5) {
                var cell = createEl('div', { className: 'spectrum-cell' });
                var hex = hslToHex(h, currentHSL.s, currentHSL.l);
                cell.style.backgroundColor = hex;
                cell.onclick = (function(hue, hexColor) {
                    return function() {
                        currentHSL.h = hue;
                        updateColorDisplay();
                        copyColor(hexColor);
                    };
                })(h, hex);
                hueSpectrum.appendChild(cell);
            }
        }

        // ============ UPDATE COLOR DISPLAY ============
        function updateColorDisplay() {
            var hex = hslToHex(currentHSL.h, currentHSL.s, currentHSL.l);
            var rgb = hexToRGB(hex);

            // Update preview
            el('colorPreview').style.backgroundColor = hex;

            // Update sliders
            el('hueSlider').value = currentHSL.h;
            el('satSlider').value = currentHSL.s;
            el('lightSlider').value = currentHSL.l;

            el('hueValue').textContent = currentHSL.h;
            el('satValue').textContent = currentHSL.s + '%';
            el('lightValue').textContent = currentHSL.l + '%';

            // Update inputs
            el('hexInput').value = hex;
            el('rgbInput').value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
            el('hslInput').value = 'hsl(' + currentHSL.h + ', ' + currentHSL.s + '%, ' + currentHSL.l + '%)';

            // Update slider backgrounds
            updateSliderBackgrounds();

            // Update wheel indicator
            updateWheelIndicator();

            // Update nuances
            renderNuancesGrids();

            // Update harmonies if visible
            if (document.querySelector('#harmonies.active')) {
                renderHarmonies();
            }
        }

        // ============ ROLE COLORS ============
        function renderRoleColors() {
            var container = el('roleColors');
            clearEl(container);

            Object.keys(ROLES).forEach(function(roleKey) {
                var role = ROLES[roleKey];
                var scale = generateScale(role.hex);

                var card = createEl('div', { className: 'role-card' });

                var header = createEl('div', { className: 'role-header' });
                var swatch = createEl('div', { className: 'role-swatch' });
                swatch.style.backgroundColor = role.hex;
                var info = createEl('div');
                var name = createEl('div', { className: 'role-name' }, role.emoji + ' ' + role.name);
                var hexSpan = createEl('div', { className: 'role-hex' }, role.hex);
                info.appendChild(name);
                info.appendChild(hexSpan);
                header.appendChild(swatch);
                header.appendChild(info);
                card.appendChild(header);

                var scaleContainer = createEl('div', { className: 'role-scale' });
                Object.keys(scale).forEach(function(step) {
                    var row = createEl('div', { className: 'scale-row' });
                    var label = createEl('span', { className: 'scale-label' }, step);
                    var sw = createEl('div', { className: 'scale-swatch' });
                    sw.style.backgroundColor = scale[step];
                    sw.style.color = isLightColor(scale[step]) ? '#1a1a2e' : '#ffffff';
                    sw.textContent = scale[step];
                    sw.onclick = (function(h) { return function() { copyColor(h); }; })(scale[step]);
                    row.appendChild(label);
                    row.appendChild(sw);
                    scaleContainer.appendChild(row);
                });
                card.appendChild(scaleContainer);

                container.appendChild(card);
            });
        }

        // ============ HARMONIES ============
        function renderHarmonies() {
            var container = el('harmoniesContainer');
            clearEl(container);

            var baseHex = hslToHex(currentHSL.h, currentHSL.s, currentHSL.l);
            var harmonies = [
                { name: 'Compl√©mentaire', colors: [baseHex, hslToHex(currentHSL.h + 180, currentHSL.s, currentHSL.l)] },
                { name: 'Analogue', colors: [hslToHex(currentHSL.h - 30, currentHSL.s, currentHSL.l), baseHex, hslToHex(currentHSL.h + 30, currentHSL.s, currentHSL.l)] },
                { name: 'Triadique', colors: [baseHex, hslToHex(currentHSL.h + 120, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 240, currentHSL.s, currentHSL.l)] },
                { name: 'Split-Compl√©mentaire', colors: [baseHex, hslToHex(currentHSL.h + 150, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 210, currentHSL.s, currentHSL.l)] },
                { name: 'T√©tradique', colors: [baseHex, hslToHex(currentHSL.h + 90, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 180, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 270, currentHSL.s, currentHSL.l)] },
                { name: 'Carr√©', colors: [baseHex, hslToHex(currentHSL.h + 90, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 180, currentHSL.s, currentHSL.l), hslToHex(currentHSL.h + 270, currentHSL.s, currentHSL.l)] },
                { name: 'Monochromatique', colors: [
                    hslToHex(currentHSL.h, currentHSL.s, 85),
                    hslToHex(currentHSL.h, currentHSL.s, 65),
                    baseHex,
                    hslToHex(currentHSL.h, currentHSL.s, 35),
                    hslToHex(currentHSL.h, currentHSL.s, 20)
                ]},
                { name: 'Tons chauds', colors: [
                    hslToHex(0, 80, 50),
                    hslToHex(30, 80, 50),
                    hslToHex(45, 80, 50),
                    hslToHex(60, 70, 50)
                ]},
                { name: 'Tons froids', colors: [
                    hslToHex(180, 60, 45),
                    hslToHex(210, 70, 50),
                    hslToHex(240, 60, 50),
                    hslToHex(270, 50, 50)
                ]}
            ];

            harmonies.forEach(function(harmony) {
                var card = createEl('div', { className: 'harmony-card' });
                var title = createEl('div', { className: 'harmony-title' }, 'üéµ ' + harmony.name);
                var colors = createEl('div', { className: 'harmony-colors' });

                harmony.colors.forEach(function(hex) {
                    var sw = createEl('div', { className: 'harmony-swatch' });
                    sw.style.backgroundColor = hex;
                    sw.style.color = isLightColor(hex) ? '#1a1a2e' : '#ffffff';
                    var hexText = createEl('div', { className: 'harmony-hex' }, hex);
                    sw.appendChild(hexText);
                    sw.onclick = function() { copyColor(hex); };
                    colors.appendChild(sw);
                });

                card.appendChild(title);
                card.appendChild(colors);
                container.appendChild(card);
            });
        }

        // ============ PALETTE GENERATOR ============
        function initPaletteGenerator() {
            // Initialize palette with role colors
            palette = [
                { hex: ROLES.searcher.hex, locked: true, name: 'Searcher' },
                { hex: ROLES.owner.hex, locked: true, name: 'Owner' },
                { hex: ROLES.resident.hex, locked: true, name: 'Resident' },
                { hex: '#2ECC71', locked: false, name: 'Accent 1' },
                { hex: '#3498DB', locked: false, name: 'Accent 2' }
            ];

            // Harmony options
            var harmonyOpts = [
                { id: 'analogous', label: 'Analogue' },
                { id: 'complementary', label: 'Compl√©mentaire' },
                { id: 'triadic', label: 'Triadique' },
                { id: 'split', label: 'Split' },
                { id: 'random', label: 'Al√©atoire' }
            ];
            var harmonyContainer = el('harmonyOptions');
            harmonyOpts.forEach(function(opt) {
                var btn = createEl('button', {
                    className: 'option-btn' + (opt.id === generatorSettings.harmony ? ' active' : '')
                }, opt.label);
                btn.onclick = function() {
                    document.querySelectorAll('#harmonyOptions .option-btn').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    generatorSettings.harmony = opt.id;
                };
                harmonyContainer.appendChild(btn);
            });

            // Lightness options
            var lightnessOpts = [
                { id: 'light', label: 'Clair' },
                { id: 'medium', label: 'Moyen' },
                { id: 'dark', label: 'Sombre' },
                { id: 'mixed', label: 'Mixte' }
            ];
            var lightnessContainer = el('lightnessOptions');
            lightnessOpts.forEach(function(opt) {
                var btn = createEl('button', {
                    className: 'option-btn' + (opt.id === generatorSettings.lightness ? ' active' : '')
                }, opt.label);
                btn.onclick = function() {
                    document.querySelectorAll('#lightnessOptions .option-btn').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    generatorSettings.lightness = opt.id;
                };
                lightnessContainer.appendChild(btn);
            });

            // Saturation options
            var satOpts = [
                { id: 'pastel', label: 'Pastel' },
                { id: 'vibrant', label: 'Vibrant' },
                { id: 'muted', label: 'Sourd' },
                { id: 'mixed', label: 'Mixte' }
            ];
            var satContainer = el('saturationOptions');
            satOpts.forEach(function(opt) {
                var btn = createEl('button', {
                    className: 'option-btn' + (opt.id === generatorSettings.saturation ? ' active' : '')
                }, opt.label);
                btn.onclick = function() {
                    document.querySelectorAll('#saturationOptions .option-btn').forEach(function(b) { b.classList.remove('active'); });
                    btn.classList.add('active');
                    generatorSettings.saturation = opt.id;
                };
                satContainer.appendChild(btn);
            });

            renderPalette();
        }

        function renderPalette() {
            var container = el('paletteColors');
            clearEl(container);

            palette.forEach(function(color, index) {
                var slot = createEl('div', { className: 'palette-slot' + (color.locked ? ' locked' : '') });
                slot.style.backgroundColor = color.hex;
                slot.style.color = isLightColor(color.hex) ? '#1a1a2e' : '#ffffff';

                var hex = createEl('div', { className: 'palette-slot-hex' }, color.hex);
                var name = createEl('div', { className: 'palette-slot-name' }, color.name);
                slot.appendChild(hex);
                slot.appendChild(name);

                slot.onclick = function(e) {
                    if (e.shiftKey) {
                        color.locked = !color.locked;
                        renderPalette();
                    } else {
                        copyColor(color.hex);
                    }
                };

                container.appendChild(slot);
            });
        }

        function generatePalette() {
            paletteHistory.push(JSON.stringify(palette));
            if (paletteHistory.length > 20) paletteHistory.shift();

            var baseColor = palette.find(function(c) { return c.locked; });
            var baseHSL = baseColor ? hexToHSL(baseColor.hex) : { h: Math.random() * 360, s: 70, l: 50 };

            var lightness = {
                light: function() { return 65 + Math.random() * 20; },
                medium: function() { return 45 + Math.random() * 20; },
                dark: function() { return 25 + Math.random() * 20; },
                mixed: function() { return 25 + Math.random() * 50; }
            }[generatorSettings.lightness];

            var saturation = {
                pastel: function() { return 30 + Math.random() * 30; },
                vibrant: function() { return 70 + Math.random() * 25; },
                muted: function() { return 20 + Math.random() * 30; },
                mixed: function() { return 30 + Math.random() * 60; }
            }[generatorSettings.saturation];

            var newHues = [];
            switch (generatorSettings.harmony) {
                case 'analogous':
                    newHues = [baseHSL.h - 30, baseHSL.h + 30];
                    break;
                case 'complementary':
                    newHues = [baseHSL.h + 180, baseHSL.h + 180 + 30];
                    break;
                case 'triadic':
                    newHues = [baseHSL.h + 120, baseHSL.h + 240];
                    break;
                case 'split':
                    newHues = [baseHSL.h + 150, baseHSL.h + 210];
                    break;
                default:
                    newHues = [Math.random() * 360, Math.random() * 360];
            }

            var hueIndex = 0;
            palette.forEach(function(color) {
                if (!color.locked) {
                    var h = hueIndex < newHues.length ? newHues[hueIndex++] : Math.random() * 360;
                    color.hex = hslToHex(h, saturation(), lightness());
                }
            });

            renderPalette();
        }

        function undoPalette() {
            if (paletteHistory.length > 0) {
                palette = JSON.parse(paletteHistory.pop());
                renderPalette();
            }
        }

        // ============ MEGA SPECTRUM ============
        function renderMegaSpectrum() {
            var container = el('megaSpectrum');
            clearEl(container);

            // Create a complete color space grid: 72 hues x 5 saturations x 20 lightness levels
            var saturations = [100, 80, 60, 40, 20];

            for (var l = 95; l >= 5; l -= 5) {
                var row = createEl('div', { className: 'spectrum-row' });
                for (var h = 0; h < 360; h += 5) {
                    for (var si = 0; si < saturations.length; si++) {
                        var s = saturations[si];
                        var cell = createEl('div', { className: 'mega-cell' });
                        var hex = hslToHex(h, s, l);
                        cell.style.backgroundColor = hex;
                        cell.title = hex + ' (H:' + h + ' S:' + s + ' L:' + l + ')';
                        cell.onclick = (function(hexColor, hue, sat, light) {
                            return function() {
                                currentHSL = { h: hue, s: sat, l: light };
                                copyColor(hexColor);
                            };
                        })(hex, h, s, l);
                        row.appendChild(cell);
                    }
                }
                container.appendChild(row);
            }
        }

        // ============ EXPORT ============
        function exportCSS() {
            var css = ':root {\n';
            css += '  /* IzzIco Color System */\n\n';

            // Role colors with scales
            Object.keys(ROLES).forEach(function(roleKey) {
                var role = ROLES[roleKey];
                var scale = generateScale(role.hex);
                css += '  /* ' + role.name + ' */\n';
                Object.keys(scale).forEach(function(step) {
                    css += '  --' + roleKey + '-' + step + ': ' + scale[step] + ';\n';
                });
                css += '\n';
            });

            // Current palette
            css += '  /* Generated Palette */\n';
            palette.forEach(function(c, i) {
                css += '  --palette-' + (i + 1) + ': ' + c.hex + ';\n';
            });

            // Gradient
            css += '\n  /* Brand Gradient */\n';
            css += '  --gradient-brand: linear-gradient(135deg, ' + ROLES.searcher.hex + ', ' + ROLES.resident.hex + ', ' + ROLES.owner.hex + ');\n';
            css += '}';

            return css;
        }

        function exportTailwind() {
            var config = 'module.exports = {\n  theme: {\n    extend: {\n      colors: {\n';

            Object.keys(ROLES).forEach(function(roleKey) {
                var role = ROLES[roleKey];
                var scale = generateScale(role.hex);
                config += "        '" + roleKey + "': {\n";
                Object.keys(scale).forEach(function(step) {
                    config += "          '" + step + "': '" + scale[step] + "',\n";
                });
                config += '        },\n';
            });

            config += '      }\n    }\n  }\n}';
            return config;
        }

        function showExport(type) {
            var section = el('exportSection');
            section.style.display = 'block';

            var content = type === 'css' ? exportCSS() : exportTailwind();
            el('exportContent').textContent = content;
        }

        // ============ COPY COLOR ============
        function copyColor(hex) {
            navigator.clipboard.writeText(hex);
            showToast('Couleur ' + hex + ' copi√©e !');
        }

        // ============ TAB NAVIGATION ============
        function initTabs() {
            document.querySelectorAll('.tab').forEach(function(tab) {
                tab.onclick = function() {
                    document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
                    document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });

                    tab.classList.add('active');
                    var section = el(tab.dataset.section);
                    section.classList.add('active');

                    // Render section content on switch
                    if (tab.dataset.section === 'roles') renderRoleColors();
                    if (tab.dataset.section === 'harmonies') renderHarmonies();
                    if (tab.dataset.section === 'spectrum') renderMegaSpectrum();
                };
            });
        }

        // ============ EVENT LISTENERS ============
        function initEvents() {
            // Color wheel click
            el('colorWheel').onclick = handleWheelClick;

            // HEX input
            el('hexInput').onchange = function() {
                var hex = this.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                    currentHSL = hexToHSL(hex);
                    updateColorDisplay();
                }
            };

            // Copy buttons
            document.querySelectorAll('.copy-btn').forEach(function(btn) {
                btn.onclick = function() {
                    var type = this.dataset.copy;
                    var value = el(type + 'Input').value;
                    navigator.clipboard.writeText(value);
                    showToast(type.toUpperCase() + ' copi√©: ' + value);
                };
            });

            // Generator buttons
            el('generateBtn').onclick = generatePalette;
            el('undoBtn').onclick = undoPalette;
            el('exportCssBtn').onclick = function() { showExport('css'); };
            el('exportTailwindBtn').onclick = function() { showExport('tailwind'); };

            // Keyboard shortcuts
            document.onkeydown = function(e) {
                if (e.code === 'Space' && !e.target.matches('input')) {
                    e.preventDefault();
                    generatePalette();
                }
            };
        }

        // ============ INIT ============
        function init() {
            drawColorWheel();
            initSliders();
            initTabs();
            initEvents();
            initPaletteGenerator();
            updateColorDisplay();
        }

        init();
    </script>
</body>
</html>
